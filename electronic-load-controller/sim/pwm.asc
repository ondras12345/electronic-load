Version 4
SHEET 1 888 760
WIRE 400 -160 176 -160
WIRE 576 -160 480 -160
WIRE 720 -160 576 -160
WIRE 176 -80 176 -160
WIRE 128 -64 48 -64
WIRE 176 32 176 16
WIRE 576 112 576 -160
WIRE 720 112 720 -160
WIRE 176 144 176 112
WIRE 352 144 176 144
WIRE 448 144 352 144
WIRE -224 160 -400 160
WIRE -160 160 -224 160
WIRE 48 160 48 -64
WIRE 48 160 -80 160
WIRE 176 160 176 144
WIRE 352 176 352 144
WIRE 176 256 176 240
WIRE 720 256 720 192
WIRE 832 256 720 256
WIRE 832 272 832 256
WIRE -400 304 -400 160
WIRE -224 304 -224 160
WIRE 48 336 48 160
WIRE 128 336 48 336
WIRE 832 416 832 352
WIRE 176 448 176 352
WIRE 352 448 352 240
WIRE 352 448 176 448
WIRE 576 448 576 192
WIRE 576 448 352 448
WIRE 720 448 720 256
WIRE 720 448 576 448
WIRE 176 512 176 448
WIRE 352 512 352 448
WIRE -400 624 -400 384
WIRE -224 624 -224 384
WIRE -224 624 -400 624
WIRE 176 624 176 576
WIRE 176 624 -224 624
WIRE 352 624 352 576
WIRE 352 624 176 624
WIRE 832 624 832 496
WIRE 832 624 352 624
WIRE 176 656 176 624
FLAG 176 656 0
SYMBOL nmos 128 256 R0
SYMATTR InstName M1
SYMATTR Value BSS145
SYMBOL pmos 128 16 M180
SYMATTR InstName M2
SYMATTR Value BSS84
SYMBOL res 160 16 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res 160 144 R0
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL cap 336 176 R0
SYMATTR InstName C1
SYMATTR Value 1µ
SYMBOL voltage 576 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 2.5
SYMBOL res 496 -176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 2k2
SYMBOL diode 160 512 R0
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL res -64 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL voltage -224 288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0 5 0 0 0 {256u*duty} 256u)
SYMBOL cap 336 512 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL res 704 96 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL res -416 288 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL voltage 832 400 R0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL res 816 256 R0
SYMATTR InstName R7
SYMATTR Value 1k
TEXT -160 -16 Left 2 ;TODO wrong nfet
TEXT -256 680 Left 2 !.tran 100m
TEXT -248 712 Left 2 !.step param duty list 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 0.95 0.99 1.0
